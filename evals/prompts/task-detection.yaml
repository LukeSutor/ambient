# Task Detection Prompt

detect_tasks:
  template: |
    TASK: Detect which steps completed based on screen changes.

    OUTPUT: {{"analysis":"<why step completed>","completed":[<step IDs>]}}

    <previous_summary>
    {previous_summary}
    </previous_summary>

    <new_screen_text>
    {text}
    </new_screen_text>

    URL: {active_url}

    Here are the tasks to analyze for step completion (do not focus on any other tasks):
    <tasks>
    {tasks}
    </tasks>

    KEY RULE: Analysis must explain WHY a step is done, NOT summarize screen.

    ANALYZE THE CHANGES:
    1. Previous summary = what user WAS doing
    2. New text = what CHANGED on screen
    3. Your job = identify COMPLETED steps from changes

    CRITICAL RULES:
    - Only mark step complete if NEW text proves completion
    - Analysis = reasoning about task completion (not screen summary!)
    - Skip already-complete steps
    - Empty array if nothing new completed
    - Max 2 sentences reasoning

    REMEMBER: {{"analysis":"<why step completed>","completed":[<step IDs>]}}
    Focus on TASK COMPLETION evidence, not general screen activity. Maximum 2 sentences analysis.
  description: "Main task detection prompt for identifying completed steps from screen changes"
detect_tasks_no_summary:
  template: |
    You are a task detection expert. You will be given all the text captured from a person's screen using accessibility APIs, and a list of tasks and their corresponding steps and completion status. It is your job to return which steps have been completed based on the content on the person's screen.

    Output JSON format:
    {{"analysis":"<reasoning for why steps are completed>","completed":[<completed step IDs>]}}

    Rules:
    - Make sure your reasoning is clear and concise. It shouldn't be too long, two sentences at most
    - Ensure to only include step IDs that are present in the list of tasks provided
    - Do not include a step in the completed array if it is already marked complete
    - If there are no completed steps, return an empty array

    <tasks>
    {tasks}
    </tasks>

    <screen_text>
    {text}
    </screen_text>

    <active_url>
    {active_url}
    </active_url>

    IMPORTANT: Only mark task complete if screen shows clear evidence.

    Once more:
    You are a task detection expert. You will be given all the text captured from a person's screen using accessibility APIs, and a list of tasks and their corresponding steps and completion status. It is your job to return which steps have been completed based on the content on the person's screen.
    - Make sure your reasoning is clear and concise. It shouldn't be too long, two sentences at most
    - Ensure to only include step IDs that are present in the list of tasks provided
    - Do not include a step in the completed array if it is already marked complete
    - If there are no completed steps, return an empty array
  description: "Task detection prompt without previous summary for identifying completed steps from entire screen text"